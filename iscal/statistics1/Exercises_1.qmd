---
title: "Chapter I - Statistics I - Exercises"
format: 
  html:
    css: [Exercises/webex.css]
    include-after-body: [Exercises/webex.js]
    embed-resources: true
lang: en
editor: source
page-layout: full
---

```{r setup, include = FALSE, echo = FALSE}
knitr::opts_chunk$set(echo = FALSE)

library(webexercises)
```

```{r, echo = FALSE, include = FALSE}
library(lubridate)
y <- year(Sys.Date())-1
```

```{r, echo = FALSE, results='asis'}
# Uncomment to change widget colours:
#style_widgets(incorrect = "goldenrod", correct = "purple", highlight = "firebrick")
```

This is a set of exercises created by the teaching Faculty for Statistics I, Chapter I - Index Numbers, from the Lisbon Accounting and Business School.

## Questions

### Question 1

::: {.webex-check .webex-box}

Consider the following sales data, in thousands of euros, for a given company:

::: {.table}
| Year | `r y-5` | `r y-4` | `r y-3` | `r y-2` | `r y-1` | `r y` |
| ---  | :---:   | :---:   | :---:   | :---:   | :---:   | :---: |
|Sales | 500 | 650 | 600 | 800 | 750 | 950 |
:::

1. Build the index series with fix base in `r y-5`.

| Year | `r y-5` | `r y-4` | `r y-3` | `r y-2` | `r y-1` | `r y` |
| ---  | :---:   | :---:   | :---:   | :---:   | :---:   | :---: |
|$I^{sales}_{t|`r y-5`}$ | `r fitb(c(1,100))` | `r fitb(c(round(650/500,4), round(100*650/500,2)))` | `r fitb(c(round(600/500,4), round(100*600/500,2)))` | `r fitb(c(round(800/500,4), round(100*800/500,2)))` | `r fitb(c(round(750/500,4), round(100*750/500,2)))` | `r fitb(c(round(950/500,4), round(100*950/500,2)))` |

2. `r torf(TRUE)` We could say that in year `r y-3`, according to the index computed above, sales increased 20% relative to the base year.

3. Study the evolution of sales, between consecutive years.

`r hide("Solution")`

We need to compute the link or chain index.

::: {.table}
| Year | `r y-5` | `r y-4` | `r y-3` | `r y-2` | `r y-1` | `r y` |
| ---  | :---:   | :---:   | :---:   | :---:   | :---:   | :---: |
|Sales | 500 | 650 | 600 | 800 | 750 | 950 |
|$I^{sales}_{chain}$ | | `r round(100*650/500,1)` | `r round(100*600/650,1)` | `r round(100*800/600,1)` | `r round(100*750/800,1)` | `r round(100*950/750,1)` |
:::

From `r y-5` to `r y-4` sales grew by 30%, from `r y-4` to `r y-3` sales diminished 7.7%, from `r y-3` to `r y-2` sales grew 33.3%, from `r y-2` to `r y-1` sales dropped 6.2%, and from `r y-1` to `r y` sales grew 26.7%.

`r unhide()`

4. What happened to sales during the whole studied period?

`r hide("Solution")`

Sales grew 90%, between `r y-5` and `r y`.

`r unhide()`

5. The growth rate between `r y-3` and `r y-1` was `r mcq(c(answer = "25%", "90%", "14%", "none of the above"))`

6. The (rounded) average growth rate in the studied period is `r mcq(c("18%", "9%", answer="14%", "None of the above"))`

:::

### Question 2

::: {.webex-check .webex-box}

Consider the following sales data, in thousands of euros, for a given company:

::: {.table}
| Year | `r y-5` | `r y-4` | `r y-3` | `r y-2` | `r y-1` | `r y` |
| ---  | :---:   | :---:   | :---:   | :---:   | :---:   | :---: |
|Sales | 300 | 250 | $a$ | 240 | $b$ | 340 |
:::

1. `r torf(TRUE)` The average growth rate for sales, between `r y-5` and `r y` was, approximately, 2.53%.

2. Let $i_{`r y-3`|`r y-5`}=67$. Also, assume you know that the growth rate doubled between `r y-2` and `r y-1`. The values for $a$ and $b$ are respectively: `r mcq(c(answer="201 and 333.1", "201 and 300", "240 and 333.1", "None of the above"))`

3. `r torf(TRUE)` The average growth rate needed to triple sales between `r y` and `r y+4` would have to be 31.61%.

4. `r torf(FALSE)` Assuming an average growth rate of 10%, it would be necessary to wait for 6 years for sales to triple.

:::

### Question 3

::: {.webex-check .webex-box}

A given company presented their financial statements with the following information:

::: {.table}
| Year | `r y-5` | `r y-4` | `r y-3` | `r y-2` | `r y-1` | `r y` |
| ---  | :---:   | :---:   | :---:   | :---:   | :---:   | :---: |
|Growth rate of sales |  | 20% | 15% | 20% | 10% | 25% |
| Price Index (base = `r y-3`) | 81.17 | 89.29| 100 | 115 | 128.8 | 148.12 | 
:::

```{r}
sol.3.1 <- (1.2*1.15*1.2*1.1*1.25)^0.2 - 1
```

1. Write the average growth rate of (nominal) sales for the whole period (rounded up, for example 11 if percentage, or 0.11 if decimal): `r fitb(round(sol.3.1,0), round(100*sol.3.1,0))`

2. Find the annual **real** growth rate for sales, when this was negative.

`r hide('Solution')`

Start building the index for sales, base `r y-3`, and remember $i^v_{t|b}=i^q_{t|b}\times i^p_{t|b}$ to build the real growth rates:

::: {.table}
| Year | `r y-5` | `r y-4` | `r y-3` | `r y-2` | `r y-1` | `r y` |
| ---  | :---:   | :---:   | :---:   | :---:   | :---:   | :---: |
| Sales Index (base = `r y-3`) | `r round(100/(1.15*1.2),2)` | `r round(100/1.15,2)` | 100 | `r 100*1.2` | `r 100*1.2*1.1` | `r 100*1.2*1.1*1.25` |
| Price Index (base = `r y-3`) | 81.17 | 89.29| 100 | 115 | 128.8 | 148.12 | 
| Real Sales Index (base = `r y-3`) | `r round(100*72.46/81.17,2)` | `r round(100*86.96/89.29,2)`| 100 | `r round(100*120/115,2)` | `r round(100*132/128.8,2)` | `r round(100*165/148.12,2)` | 
:::

Clearly, the real growth rate was negative in `r y-1`, and it was `r round(100*102.48/104.35,2)-100`%.

`r unhide()`

3. How do you interpret the price index for years `r y-5` and `r y-4`?

`r hide('Solution')`

From `r y-5` to `r y-3` prices grew `r round(100*(100/81.17-1),2)` %, and from `r y-4` to `r y-3` prices grew `r round(100*(100/89.29-1),2)` %.

`r unhide()`

:::


### Question 4

::: {.webex-check .webex-box}

For some country, water consumption in the period `r y-8` and `r y` evolved according the simple index, base `r y-3`, shown in the following table:

::: {.table}
| Year | `r y-8` | `r y-7`| `r y-6`| `r y-5` | `r y-4` | `r y-3` | `r y-2` | `r y-1` | `r y` |
| ---  | :---:   | :---:   | :---:   | :---:   | :---:   | :---: | :---:   | :---:   | :---: |
| Sales Index (base = `r y-3`) | 75.6 | 78.5 | 82.5 | 88.1 | 93.8 | 100 | 104.8 | 107.7 | 107.9 |
:::

1. `r torf(FALSE)` Water consumption betwee `r y-6` and `r y-4` grew 12.5%.

2. `r torf(TRUE)`

3. Taking yera `r y-8` as base year, $i_{`r y`|`r y-8`}$ would be equal to: `r mcq(c("136.32", answer="142.7", "175.6", "None of the above"))` 



4. `r torf(FALSE)` The average growth rate for water consumption in the whole period was 4.54%. Overall, during the whole period, water consumption grew 36.32%.

:::

### Question 5

::: {.webex-check .webex-box}

Wayne Industries reported sales using the chain index shown in the following table:

::: {.table}
| Year | `r y-6`| `r y-5` | `r y-4` | `r y-3` | `r y-2` | `r y-1` | `r y` |
| ---  | :---:   | :---:   | :---:   | :---: | :---:   | :---:   | :---: |
| Sales Index | 120 | 125 | 135 | 145 | 150 | 160 | 165 |
:::

1. The average growth rate between `r y-6` and `r y` was approximately: `r mcq(c("50%", "42.86%", answer="46.01%", "None of the above"))`


2. The growth rate for sales between `r y-7` and `r y` is approximately: `r mcq(c(answer="1062.8%","65%","42.86","None of the above"))`

3. `r torf(TRUE)` The average semi-annual growth rate between `r y-4` and `r y-1` is approximately 23.10%.

4. `r torf(FALSE)` The value for the semi-annual growth rate, in real terms, if the IPC (fix base) went from 130 in `r y-4` to 180 in `r y-1`, is approximately equal to 10%.

:::

### Question 6

```{r , include = FALSE, echo = FALSE}
library(eurostat)
library(tidyverse)
library(lubridate)

# Set parameters
end_year <- year(Sys.Date())-1
start_year <- end_year - 7
geo <- "EU27_2020"  # EU27 (post-Brexit)

####################
# Dealing with GDP #
####################

data_gdp <- get_eurostat("nama_10_gdp",
                     filters = list(
                       geo = geo,
                       unit = "CLV05_MEUR",  # GDP Base 15 Million of Euro
                       na_item = "B1GQ", # GDP Gross domestic product at market prices (chain-linked volumes)
                       time = as.character(start_year:end_year)
                      )
                     )

data_gdp_year <- data_gdp %>%
  select(time, values) %>%
  mutate(year = time) %>%
  select(-time) %>%
  rename(GDP = values) %>%
  mutate(year=year(as_date(year)))

#######################
# Dealing with Prices #
#######################

data_prices <-  get_eurostat("prc_hicp_midx",
                        filters = list(
                          geo = geo,
                          coicop = "CP00",
                          unit="I15"
                          )
                        )

data_prices_year <- data_prices %>% 
  mutate(year = year(as_date(time))) %>%
  group_by(year) %>%
  mutate(CPI = mean(values, na.rm = TRUE)) %>%
  ungroup() %>%
  select(-unit, -coicop, -geo, -time, -freq, -values) %>%
  distinct() %>%
  filter(year >= start_year)

#################
# Final Dataset #
#################

data <- merge(data_gdp_year, data_prices_year, by = 'year')

data_link <- data %>%
  mutate(
    CPI_link = round(CPI/lag(CPI)*100, 1)
  )

data_long <- data_link %>% select(-CPI) %>%
  pivot_longer(cols = c(GDP, CPI_link),
               names_to = "indicator",
               values_to = "value")

data_horizontal <- data_long %>%
  pivot_wider(names_from = year, values_from = value)

```

::: {.webex-check .webex-box}

Consider the following data with respect to the evolution of the Euro Area GDP (EU27) between `r y-7` and `r y-1`, constant prices (base 2015), as well as the chain index for prices for the same period:

```{r}

library(knitr)
kable(data_horizontal)

```

:::

## Example Questions

### Fill-In-The-Blanks (`fitb()`)

Create fill-in-the-blank questions using `fitb()`, providing the answer as the first argument.

- 2 + 2 is `r fitb(4)`

You can also create these questions dynamically, using variables from your R session.

```{r}
x <- sample(2:8, 1)
```

- The square root of `r x^2` is: `r fitb(x)`

The blanks are case-sensitive; if you don't care about case, use the argument `ignore_case = TRUE`.

- What is the letter after D? `r fitb("E", ignore_case = TRUE)`

If you want to ignore differences in whitespace use, use the argument `ignore_ws = TRUE` (which is the default) and include spaces in your answer anywhere they could be acceptable.

- How do you load the tidyverse package? `r fitb(c("library( tidyverse )", "library( \"tidyverse\" )", "library( 'tidyverse' )"), ignore_ws = TRUE, width = "20")`

You can set more than one possible correct answer by setting the answers as a vector.

- Type a vowel: `r fitb(c("A", "E", "I", "O" , "U"), ignore_case = TRUE)`

You can use regular expressions to test answers against more complex rules.

- Type any 3 letters: `r fitb("^[a-zA-Z]{3}$", width = 3, regex = TRUE)`

### Multiple Choice (`mcq()`)

- "Never gonna give you up, never gonna: `r mcq(c("let you go", "turn you down", "run away", answer = "let you down"))`"
- "I `r mcq(c(answer = "bless the rains", "guess it rains", "sense the rain"))` down in Africa" -Toto

### True or False (`torf()`)

- True or False? You can permute values in a vector using `sample()`. `r torf(TRUE)`

### Longer MCQs (`longmcq()`)

When your answers are very long, sometimes a drop-down select box gets formatted oddly. You can use `longmcq()` to deal with this. Since the answers are long, It's probably best to set up the options inside an R chunk with `echo=FALSE`. 

**What is a p-value?**

```{r}
opts_p <- c(
   "the probability that the null hypothesis is true",
   answer = "the probability of the observed, or more extreme, data, under the assumption that the null-hypothesis is true",
   "the probability of making an error in your conclusion"
)
```

`r longmcq(opts_p)`

**What is true about a 95% confidence interval of the mean?**

```{r}
# use sample() to randomise the order
opts_ci <- sample(c(
  answer = "if you repeated the process many times, 95% of intervals calculated in this way contain the true mean",
  "there is a 95% probability that the true mean lies within this range",
  "95% of the data fall within this range"
))
```

`r longmcq(opts_ci)`

## Checked sections

Create sections with the class `webex-check` to add a button that hides feedback until it is pressed. Add the class `webex-box` to draw a box around the section (or use your own styles).

::: {.webex-check .webex-box}

I am going to learn a lot: `r torf(TRUE)`

```{r, results='asis'}
opts <- c(
   "the probability that the null hypothesis is true",
   answer = "the probability of the observed, or more extreme, data, under the assumption that the null-hypothesis is true",
   "the probability of making an error in your conclusion"
)

cat("What is a p-value?", longmcq(opts))
```

:::



## Hidden solutions and hints

You can fence off a solution area that will be hidden behind a button using `hide()` before the solution and `unhide()` after, each as inline R code.  Pass the text you want to appear on the button to the `hide()` function.

If the solution is a code chunk, instead of using `hide()` and `unhide()`, simply set the `webex.hide` chunk option to TRUE, or set it to the string you wish to display on the button.

**Recreate the scatterplot below, using the built-in `cars` dataset.**

```{r}
with(cars, plot(speed, dist))
```


`r hide("I need a hint")`

See the documentation for `plot()` (`?plot`)

`r unhide()`

<!-- note: you could also just set webex.hide to TRUE -->

```{r, echo = TRUE, eval = FALSE}
#| webex.hide: "Click here to see the solution"
plot(cars$speed, cars$dist)
```
