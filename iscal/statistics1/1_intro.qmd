---
title: "Introduction and Growth Rates"
author: "Paulo Fagandini"
institute: "Lisbon Accounting and Business School – Polytechnic University of Lisbon"
format: 
  revealjs:
    theme: default
    slide-number: true
    cross-ref: true
    incremental: true
    math: 
      method: mathjax
    transition: slide
    footer: "Statistics I"
    from: markdown+emoji
    code-overflow: wrap
    code-block-font-size: 0.75em
    progress: true
editor: source
execute:
  enabled: true
engine: knitr
---

# Course Introduction

## Core Information

**Instructor:** Paulo Fagandini

:email: pfagandini\@iscal.ipl.pt

\

**Main source for course material:** [Moodle\@ISCAL](https://moodle2526.ipl.pt/)

**Alternative source (EN):** [pfagandini.github.io/statistics1.html](https://pfagandini.github.io/statistics1.html)

\

**Official communication channel:** :email: Institutional Email

## Bibliography

### Topic 1:

:book: Gancho Custódio, S. et al. (2022) Números Índices, Edições Sílabo

### Topic 2:

:book: Murteira, B.; Silva Ribeiro, C.; Andrade e Silva, J. & Pimenta, C., Introdução à
Estatística, Escolar Editora, McGraw-Hill, 2010

### Topic 3:

:book: Ferreira, T., Custódio, S.G. (2023) Modelos Probabilísticos, Edições Sílabo  

## Bibliography (EN)

### Topic 1:

:book: The making of index numbers. 1^st^ Ed 1922. Irving Fisher.
:book: A Practical Introduction to Index Numbers. 1^st^ Ed 2015. Jeff Ralph, Rob O'Neill, Joe Winton.

### Topics 2 and 3:

:book: Statistics for Business and Economics Global Edition. 10^th^ Ed 2022. Paul Newbold, William Carlson, and Betty Thorne.

\

<small>This last book is a bit expensive, but it can be rented for less money [here](https://eu.pearson.com/statistics-for-business-and-economics-global-edition/9781292438306). The Publisher kindly offered a 25% discount with the code **MISLIBROS2025**. This code is valid for the whole site until December 31^st^ , 2025.</small>

## Continuous Assessment

| Assessment Element | Weight (%) | Duration   | Syllabus       | Date              |
|---------------|---------------|---------------|---------------|---------------|
| Midterm            | 60%        | 80 minutes | Topics 1 and 2 | Nov 6<sup>th</sup>    |
| Partial Exam       | 40%        | 80 minutes | Topic 3        | Regular Exam Date |

<small>Each test has a minimum grade of 7.00 (out of 20), not 6.9, not 6.95.</small>

## Comprehensive Exam

Students may opt, on the day of the Exam, to take an Exam worth 100% of the grade. This Exam will cover Topics 1, 2, and 3.

\

If you score less than 7.00 in the Midterm, or if you cannot attend the midterm for whatever reason, you **will** have to do the Comprehensive Exam.

## Disclaimer

These slides are a free translation and adaptation from the slide deck for Estatística I by Prof. Sandra Custódio and Prof. Teresa Ferreira from the Lisbon Accounting and Business School - Polytechnical University of Lisbon.

# Growth Rates

## Example: Apple Stock

::::: columns
::: {.column width="50%"}
```{r}
#| echo: false
#| results: 'hide'
#| fig.align: "center"

# Load required libraries
library(quantmod)
library(ggplot2)
library(dplyr)

# Set date range
end_date <- Sys.Date()
start_date <- end_date - 365*6

# Get AAPL stock data
getSymbols("AAPL", src = "yahoo", from = start_date, to = end_date, auto.assign = TRUE)
aapl_data <- AAPL

# Extract closing prices for the last trading day of each year
aapl_annual <- aapl_data %>%
  as.data.frame() %>%
  mutate(Date = index(AAPL)) %>%
  group_by(Year = format(Date, "%Y")) %>%
  slice_tail(n = 1) %>%
  ungroup()

# Create dataframe with date and closing prices
aapl_df <- data.frame(
  Date = as.numeric(aapl_annual[['Year']]),
  Close = round(aapl_annual[['AAPL.Close']], 2)
)

# Plot using ggplot2

ggplot(aapl_df, aes(x = Date, y = Close)) +
  geom_line(color = "blue") +
  labs(title = "Time Series of Closing Prices",
       x = "Year",
       y = "Close Price") +
  theme_minimal()

```

Source: Yahoo Finance
:::

::: {.column width="50%"}
```{r}
library(knitr)

# Display the table
kable(aapl_df)

```
:::
:::::

## Example: Apple Stock

Let the close price for Apple be represented by the variable $y_t$, so $y_{`r aapl_df$Date[1]`}$ is the close price we got for`r aapl_df$Date[1]` (*i.e.* `r aapl_df$Close[1]`).

How much did $y$ grow between `{r} aapl_df$Date[1]` and `{r} aapl_df$Date[2]`?

. . .

$$\Delta y_{`r aapl_df$Date[2]`} = y_{`r aapl_df$Date[2]`} - y_{`r aapl_df$Date[1]`} = `r aapl_df$Close[2]` - `r aapl_df$Close[1]`$$ $$=`r aapl_df$Close[2] - aapl_df$Close[1]`$$

. . .

Or we could say

$$y_{`r aapl_df$Date[2]`} = y_{`r aapl_df$Date[1]`} + \Delta y_{`r aapl_df$Date[2]`}$$ $$`r aapl_df$Close[2]` = `r aapl_df$Close[1]` + `r aapl_df$Close[2] - aapl_df$Close[1]`$$

## Example: Apple Stock

$$y_{`r aapl_df$Date[2]`}=y_{`r aapl_df$Date[1]`}+\Delta y_{`r aapl_df$Date[2]`}$$

$$y_{`r aapl_df$Date[2]`}=y_{`r aapl_df$Date[1]`}\left(1+\frac{\Delta y_{`r aapl_df$Date[2]`}}{y_{`r aapl_df$Date[1]`}}\right)$$

$$y_{`r aapl_df$Date[2]`}=y_{`r aapl_df$Date[1]`}\left(1+\delta^y_{`r aapl_df$Date[2]`}\right)$$

This, $\delta_{`r aapl_df$Date[2]`}^y$, is the **growth rate** of $y$ at year`r aapl_df$Date[2]`.

## Growth Rate

::: {.callout-note appearance="simple" icon="false"}
## Growth Rate

Let $y_t$ be a variable that might take different values over time. The **growth rate** at $t$ is given by $\delta_t^y$, and takes a value such that:

$$y_t=y_{t-1}\left(1+\delta_t\right)$$

And then

$$\delta_t = \frac{y_t-y_{t-1}}{y_{t-1}}$$

<small>Note: I dropped $y$ from the notation in the formula because it is obvious that we are talking about the variable $y$.</small>

You can write the growth rate as a decimal or as a percentage. If you use decimal notation, consider at least 4 places, if you use percentage you use at least 2. Example: 0.0123 or 1.23%.

**Interpretation**: What is the percentage change for the variable $y$ between $t-1$ and $t$.
:::

## Example

$$`r aapl_df$Close[2]` = `r aapl_df$Close[1]`+(`r aapl_df$Close[2]` - `r aapl_df$Close[1]`)$$

$$`r aapl_df$Close[2]` =`r aapl_df$Close[1]`\left(1+\frac{`r aapl_df$Close[2]-aapl_df$Close[1]`}{`r aapl_df$Close[1]`}\right)$$

$$`r aapl_df$Close[2]`=`r aapl_df$Close[1]`\left(1+`r round((aapl_df$Close[2]-aapl_df$Close[1])/aapl_df$Close[1], 4)`\right)$$

. . .

In this case $\delta_{`r aapl_df$Date[2]`}^y =`r round((aapl_df$Close[2]-aapl_df$Close[1])/aapl_df$Close[1], 4)` = `r 100*round((aapl_df$Close[2]-aapl_df$Close[1])/aapl_df$Close[1], 4)`\%$.

> Interpretation: Between `r aapl_df$Date[1]` and `r aapl_df$Date[2]`, the price for Apple *`r if (aapl_df$Close[1] > aapl_df$Close[2]) "decreased" else "increased"`* `r abs(100*round((aapl_df$Close[2]-aapl_df$Close[1])/aapl_df$Close[1], 4))`%.

## Growth Rates

More generally $$\delta_{t+k|t}=\frac{y_{t+k}-y_t}{y_t}$$

Or $$y_{t+k}=y_t(1+\delta_{t+k|t})$$

<small>(homework: Show step by step how you go from one to the other.)</small>

> Note: In this case $\delta_{t+k|t}$ is what percentage the variable changed from $t$ to $t+k$, and $k$ is the number of periods.

## Example

We had $y_{`r aapl_df$Date[1]`}=`r aapl_df$Close[1]`$, and $y_{`r aapl_df$Date[5]`} =`r aapl_df$Close[5]`$. We will try to find $\delta_{`r aapl_df$Date[5]`|`r aapl_df$Date[1]`}^y$

-   What is the value of $k$ in this case?

. . .

$$k=`r aapl_df$Date[5]`-`r aapl_df$Date[1]`=`r aapl_df$Date[5]-aapl_df$Date[1]`$$

-   What is the growth rate between $`r aapl_df$Date[1]`$ and $`r aapl_df$Date[5]`$?

. . .

$$\delta_{`r aapl_df$Date[5]`|`r aapl_df$Date[1]`}^y = \frac{`r aapl_df$Close[5]` - `r aapl_df$Close[1]`}{`r aapl_df$Close[1]`} = `r round((aapl_df$Close[5]-aapl_df$Close[1])/aapl_df$Close[1], 4)` = `r 100*round((aapl_df$Close[5]-aapl_df$Close[1])/aapl_df$Close[1], 4)`\%$$

> For Apple, the stock price grew `r 100*round((aapl_df$Close[5]-aapl_df$Close[1])/aapl_df$Close[1], 4)`% between `r aapl_df$Date[1]` and `r aapl_df$Date[5]`, or the stock price for Apple in `r aapl_df$Date[5]` is `r 100*round((aapl_df$Close[5]-aapl_df$Close[1])/aapl_df$Close[1], 4)`% larger than in `r aapl_df$Date[1]`.

## Growth Rates

::: callout-warning
You should be careful with your interpretation and use of this *cumulative* growth rate, because it **does not** mean that $y$ grew $\delta_{t+k|t}^y$ **per period** between $t$ and $t+k$.
:::

. . .

\

::: {.callout-note appearance="simple" icon="false"}
## Average Growth Rate

Let $y_t$ be a variable that might take different values over time. The **average growth rate** betweek $t$ and $t+k$ is given by $\overline{\delta}_{t+k|t}^y$, and takes a value such that:

$$y_{t+k}=y_t\left(1+\overline{\delta}_{t+k|t}\right)^k$$

We will use something called the *geometric mean*.

<small>I dropped $y$ from the notation in the formula because it is obvious that we are talking about the variable $y$.</small>
:::

## Growth Rates

Let's start with $y_t$... and the traditional growth rates $\delta_t$:

$$y_{t+1} = y_t(1+\delta_{t+1})$$

$$y_{t+2} = y_{t+1}(1+\delta_{t+2})$$

$$y_{t+3} = y_{t+2}(1+\delta_{t+3})$$

Can we write $y_{t+2}$ as a function of $y_t$?

. . .

$$y_{t+2} = y_{t+1}(1+\delta_{t+2}) = y_{t}(1+\delta_{t+1})(1+\delta_{t+2})$$

. . .

And $y_{t+3}$?

. . .

$$y_{t+3} = y_{t}(1+\delta_{t+1})(1+\delta_{t+2})(1+\delta_{t+3})$$

## Growth Rates

Generalizing

$$y_{t+k}=y_t (1+\delta_{t+1})...(1+\delta_{t+k-1})(1+\delta_{t+k})$$

When computing the average growth rate, we are trying to find $\overline{\delta}$ such that if the growth rate was the same every period, it would have taken $y_t$ to the value of $y_{t+k}$ all the same:

$$y_{t+k}=y_t(1+\overline{\delta})(1+\overline{\delta})...(1+\overline{\delta})$$

. . .

How many times is $(1+\overline{\delta})$ multiplied in the expression?

## Growth Rates

$$y_{t+k} = y_t \left(1+\overline{\delta}\right)^k$$

. . .

$$\frac{y_{t+k}}{y_t} = \left(1+\overline{\delta}\right)^k$$

. . .

$$\left(\frac{y_{t+k}}{y_t}\right)^{1/k} = \left(1+\overline{\delta}\right)$$

. . .

$$\left(\frac{y_{t+k}}{y_t}\right)^{1/k} - 1 = \overline{\delta}$$

$$\overline{\delta}_{t+k|t}=\left(\frac{y_{t+k}}{y_t}\right)^{1/k} - 1$$

## Example

We had $$\delta_{`r aapl_df$Date[5]`|`r aapl_df$Date[1]`}^y = \frac{`r aapl_df$Close[5]` - `r aapl_df$Close[1]`}{`r aapl_df$Close[1]`} = `r round((aapl_df$Close[5]-aapl_df$Close[1])/aapl_df$Close[1], 4)` = `r 100*round((aapl_df$Close[5]-aapl_df$Close[1])/aapl_df$Close[1], 4)`\%$$

But what now is the **average growth rate** between `r aapl_df$Date[1]` and `r aapl_df$Date[5]`?

. . .

Remember $k = `r aapl_df$Date[5]-aapl_df$Date[1]`$

$$
\overline{\delta} =
\left(\frac{`r aapl_df$Close[5]`}{`r aapl_df$Close[1]`}\right)^{1/`r aapl_df$Date[5]-aapl_df$Date[1]`} - 1
\approx `r round((aapl_df$Close[5]/aapl_df$Close[1])^(1/(aapl_df$Date[5]-aapl_df$Date[1]))-1,4)`=
`r round(100*(aapl_df$Close[5]/aapl_df$Close[1])^(1/(aapl_df$Date[5]-aapl_df$Date[1]))-100, 2)`\%
$$

> Interpretation: On average, between `r aapl_df$Date[1]` and `r aapl_df$Date[4]` $y$ `r if (aapl_df$Close[5]>aapl_df$Close[1]) 'grew' else 'decreased'` `r abs(round(100*(aapl_df$Close[5]/aapl_df$Close[1])^(1/(aapl_df$Date[5]-aapl_df$Date[1]))-100,2))`% every year.

## Example

Note that $$
(1+`r round(100*(aapl_df$Close[5]/aapl_df$Close[1])^(1/(aapl_df$Date[5]-aapl_df$Date[1]))-100, 2)`\%)^`r aapl_df$Date[5]-aapl_df$Date[1]` =
(1+`r round((aapl_df$Close[5]/aapl_df$Close[1])^(1/(aapl_df$Date[5]-aapl_df$Date[1]))-1, 4)`)^`r aapl_df$Date[5]-aapl_df$Date[1]` \approx
`r 1+round((aapl_df$Close[5]-aapl_df$Close[1])/aapl_df$Close[1], 4)`\approx
1 + `r round(100*(aapl_df$Close[5]-aapl_df$Close[1])/aapl_df$Close[1], 2)`\%
$$

# Index Numbers - Introduction and Simple Index Numbers

## Motivation

```{r}
#| echo: false
#| results: 'hide'


# Define stock symbols
high_price_stock <- "NFLX"
low_price_stock <- "AAPL"

# Set up date range for last 10 years
end_date <- Sys.Date()
start_date <- end_date - 365*10

# Download closing prices
getSymbols(high_price_stock, src = "yahoo", from = start_date, to = end_date, auto.assign = TRUE)
getSymbols(low_price_stock, src = "yahoo", from = start_date, to = end_date, auto.assign = TRUE)

# Extract closing prices
high_stock_prices <- Cl(get(high_price_stock))
low_stock_prices <- Cl(get(low_price_stock))

prices <- cbind(data.frame(high_stock_prices), data.frame(low_stock_prices))
```

```{r}
#| echo: false
#| results: 'hide'
#| fig.align: "center"

library(ggplot2)
library(reshape2)

# Combine and reshape data
prices_df <- data.frame(Date = as.Date(index(prices), origin = start_date), coredata(prices))
colnames(prices_df) <- c("Date", high_price_stock, low_price_stock)

# Convert to long format
prices_long <- melt(prices_df, id.vars = "Date", variable.name = "Stock", value.name = "Price")

# Plot
ggplot(prices_long, aes(x = Date, y = Price, color = Stock)) +
  geom_line() +
  labs(title = "Stock Prices Over Time", x = "Date", y = "Closing Price") +
  theme_minimal()


```

Which stock would you have purchased in `r start_date`?

## Motivation

What's the important question here?

. . .

Which one grew more! For this, levels are not as relevant as their evolution over time.

For example, say we have prices for two stocks A and B. Say we want to hold these stocks for only one period, which one would choose to invest your hard earned :dollar:?

. . .

How many stocks will you be able to buy of each stock, if their prices are $a_t$ and $b_t$, and you have US\$1000?

. . .

$n_a=\frac{1000}{a_t}$ of stock A and $n_b=\frac{1000}{b_t}$ of stock $B$. Note that $n_a$ and $n_b$ are the amount of stock you can buy of each.

## Motivation

Now is a new day :sunrise_over_mountains:! Prices are now $a_{t+1}$ and $b_{t+1}$, how much is your portfolio worth today?

. . .

1.  If you bought stock A: $a_{t+1} n_a = a_{t+1}\frac{1000}{a_t}$

2.  If you bought stock B: $b_{t+1} n_b = b_{t+1}\frac{1000}{b_t}$

. . .

Note that the 1000 is fixed, so it is just what we invested, it is not going to change anything in our decision on buying A vs B, what is really important is $\frac{a_{t+1}}{a_t}$ and $\frac{b_{t+1}}{b_t}$, that is the growth rate of prices for each stock, as

$$\frac{a_{t+1}}{a_t}=1+\delta_{t+1}^a \quad\text{and}\quad \frac{b_{t+1}}{b_t}=1+\delta_{t+1}^b$$

## Motivation

You did not sell and...

Now is (another) new day :sunrise_over_mountains:! Prices are now $a_{t+2}$ and $b_{t+2}$, how much is your portfolio worth today?

. . .

1.  If you bought stock A: $a_{t+2} n_a = a_{t+2}\frac{1000}{a_t}$

2.  If you bought stock B: $b_{t+2} n_b = b_{t+2}\frac{1000}{b_t}$

. . .

blah, blah...

$$\frac{a_{t+2}}{a_t}=1+\delta_{t+2}^a \quad\text{and}\quad \frac{b_{t+2}}{b_t}=1+\delta_{t+2}^b$$

If we wait two days, we only care how is the price today compared to when we made the purchase. We could make instead a plot of $1+\delta_{t+k}$ to see which grew more!

## Motivation

```{r}
#| fig.align: "center"
#| echo: false

library(ggplot2)
library(reshape2)

# Scale both series
high_p <- high_stock_prices / as.numeric(first(high_stock_prices))
low_p <- low_stock_prices / as.numeric(first(low_stock_prices))

# Combine and rename columns using stock symbols
scaled_prices <- cbind(high_p, low_p)
colnames(scaled_prices) <- c(high_price_stock, low_price_stock)

# Convert to long format
scaled_df <- data.frame(Date = index(scaled_prices), coredata(scaled_prices))
scaled_long <- melt(scaled_df, id.vars = "Date", variable.name = "Stock", value.name = "ScaledPrice")

# Plot
ggplot(scaled_long, aes(x = Date, y = ScaledPrice, color = Stock)) +
  geom_line(size = 1.2) +
  labs(
    title = paste(high_price_stock, "vs", low_price_stock),
    x = "Date",
    y = paste("Price Evolution Compared to", format(start_date, "%d/%m/%Y"))
  ) +
  theme_minimal() +
  theme(
    plot.title = element_text(size = 14, margin = margin(b = 20)),
    axis.title = element_text(size = 12),
    legend.title = element_blank(),
    legend.text = element_text(size = 12)
  ) +
  guides(color = guide_legend(override.aes = list(size = 2)))


```

Now we have a much clear picture. We can compare their evolution starting in `r start_date`.

What can you read from the plot?

## Motivation

Note that for `r start_date`, we would have, for A and B:

$$1+\frac{a_t-a_t}{a_t}=1\quad\text{and}\quad 1+\frac{b_t-b_t}{b_t}=1$$

We just built and index number!

By convention though, instead of using 1 for the reference date, we will use 100 (as in 100%) for the reference day (we will put a name to this in a few moments).

\

When our new series was 2, we understood that $1+\delta_{t+k}=2$ or $\delta_{t+k}=1$, *i.e.* the price grew 100%, or *doubled*! Now, with the new notation, we would have that the new series would take the value of 200, *i.e.* the price is now 200% the value it had at our initial date.

## Index Numbers

::: {.callout-note appearance="simple" icon="false"}
## Index Number

An **Index Number** is a scaled variable that takes as a reference point the value an underlying variable took at a fixed point in time. Say, for an underlying variable $x_t$ we build an index $I_t$.

$$I_t=\frac{x_t}{x_0}\times 100$$

Where $x_t$ is the value the underlying variable takes at time $t$, and $x_0$ represents the value this variable took at our reference point. This period is called **base**.

> Note: In this case we used time as the dimension for $t$ but this needs not be the case, we will see examples later.
:::

\

In our previous example, the base day would have been `r start_date`. Note that in the base period $$I_0=\frac{x_0}{x_0}\times 100 = 100$$

## Index Numbers

Index Numbers are defined by their underlying variable. This can change over time, or it can change according to another dimension, like geography, or both! We will see examples.

Also, an Index Number can have a fixed base or a moving base.

```{R}
library(DiagrammeR)

grViz("
digraph TimeSeriesStructure {
  graph [layout = dot, rankdir = TB]

  node [shape = box, style = filled, fillcolor = lightgray, fontname = Helvetica]

  Index [label = 'Index']
  UnderlyingVariable [label = 'Underlying Variable']
  Base [label = 'Base']
  Dimension [label = 'Dimension']

  Simple [label = 'Simple']
  Composite [label = 'Composite']

  Fixed [label = 'Fixed']
  Rolling [label = 'Rolling']

  Chronological [label = 'Chronological']
  Geographical [label = 'Geographical']

  Index -> UnderlyingVariable
  Index -> Base
  Index -> Dimension

  UnderlyingVariable -> Simple
  UnderlyingVariable -> Composite

  Base -> Fixed
  Base -> Rolling

  Dimension -> Chronological
  Dimension -> Geographical
}
")
```

## Index Numbers

::: callout-warning
## Index Numbers

-   Simple and Composite are mutually exclusive
-   Fixed and Moving are mutually exclusive
-   Rolling always needs a chronological dimension
:::

## Examples

| Type          | Example                                   |
|---------------|-------------------------------------------|
| Simple        | Single stock price                        |
| Composite     | SP500 (market index), CPI                 |
| Fixed Base    | GDP, CPI, market index                    |
| Rolling Base  | Some measures of GDP, Commodities Futures |
| Chronological | Stock price over time, CPI, GDP           |
| Geographical  | BigMac Index                              |

## Index Numbers

Importantly, an index number is *no bueno* to reflect the level of a variable, but its evolution or relative value against a base.

## Rolling Base

::: {.callout-note appearance="simple" icon="false"}
## Chain or Link Index

A **Chain or Link Index Number** is an index number that updates its base in every period.

$$I_t = \frac{x_t}{x_{t-1}}\times 100$$

> Interpretation: It tells you how much the variable increased compared to the **previous** period.
:::

## Index Numbers

Index numbers allow us to easily compute the growth rate between any two periods, just like we would do with the underlying variable:

1.  Simple Index Number

. . .

$$1+\delta_{t+k,t}=\frac{x_{t+k}}{x_t}=\frac{x_{t+k}}{x_t}=\frac{\frac{x_{t+k}}{x_0}}{\frac{x_t}{x_0}}=\frac{I_{t+k}}{I_t}$$

2.  Chain Index Number

. . .

<small>

$$1+\delta_{t+k,t}=\frac{x_{t+k}}{x_t}=\frac{x_{t+k}}{x_{t+k-1}}\frac{x_{t+k-1}}{x_{t}}=\frac{x_{t+k}}{x_{t+k-1}}\frac{x_{t+k-1}}{x_{t+k-2}}\frac{x_{t+k-2}}{x_{t}}=\frac{x_{t+k}}{x_{t+k-1}}\frac{x_{t+k-1}}{x_{t+k-2}}...\frac{x_{t+1}}{x_{t}}$$

$$1+\delta_{t+k,t}=I_{t+k}\times I_{t+k-1}\times ... \times I_{t+2} \times I_{t+1}$$

</small>

## Index Numbers

::: callout-warning
## Do not use 100 index when multiplying chain or link indices, use the decimal notation.

Note that if the underlying variable does not change at all, you should expect the same value, $x_t=x_{t+1}=x_{t+2}$

In this case $I_{t+1}=\frac{x_{t+1}}{x_t}=1$ and $I_{t+2}=\frac{x_{t+2}}{x_{t+1}}=1$, and therefore $$1+\delta_{t+2,t}=1\times 1= 1$$

This is the correct way to do it :white_check_mark:.

But if instead you used the 100 to multiply: $$1+\delta_{t+2,t}=100\times 100= 10000$$ and we get that $x$ grew 100 times! (:x: because we know that $x_t=x_{t+1}=x_{t+2}$)
:::

## Index Numbers

We can always transform a chain index number into a fixed base index number.

1.  Chose a reference, for example for period 3.

2.  Remember: what you want to achieve: $\forall t, I'_t=\frac{x_t}{x_3}$

3.  Remember: that we have $I_t=\frac{x_t}{x_{t-1}}$

4.  Use what we did just before:

. . .

$$ I_t' = I_t I_{t-1} ...I_{4} = \frac{x_t}{x_{t-1}}\frac{x_{t-1}}{x_{t-2}}...\frac{x_4}{x_3}=\frac{x_t}{x_3}=I'_t$$

## Example

```{r}
library(lubridate)
```

<small>

Suppose we want to convert this Chain Index into Fix Base index, with the base year in `r year(Sys.Date())-5`. This will be our 100.

|   | `r year(Sys.Date())-5` | `r year(Sys.Date())-4` | `r year(Sys.Date())-3` | `r year(Sys.Date())-2` | `r year(Sys.Date())-1` | `r year(Sys.Date())` |
|-----------|:---------:|:---------:|:---------:|:---------:|:---------:|:---------:|
| Price | 30 | 34 | 37 | 35 | 36 | 39 |
|  |  | $\frac{34}{30} 100$ | $\frac{37}{34} 100$ | $\frac{35}{37} 100$ | $\frac{36}{35} 100$ | $\frac{39}{36} 100$ |
| $I_{chain}$ |  | `r round(34/30*100,1)` | `r round(37/34*100,1)` | `r round(35/37*100,1)` | `r round(34/35*100,1)` | `r round(39/36*100,1)` |
|  |  | $100\frac{113.3}{100}$ | $113.3\frac{108.8}{100}$ | $123.3\frac{94.6}{100}$ | $116.7 \frac{97.1}{100}$ | $120\frac{108.3}{100}$ |
| $I_{t|`r year(Sys.Date())-5`}$ | 100 | `r round(34/30*100,1)` | `r round(37/30*100,1)` | `r round(35/30*100,1)` | `r round(36/30*100,1)` | `r round(39/30*100,1)` |

Note that, for example in `r year(Sys.Date())-1`, we have $I_{`r year(Sys.Date())-1`|`r year(Sys.Date())-5`}=116.7$, which was computed as $123.3\times\frac{94.6}{100}$. But $123.3$ was the base `r year(Sys.Date())-5` index of the previous period, which in turn was computed as $113.3\frac{108.8}{100}$, so in reality:

$$116.7=123.3\frac{94.6}{100}=113.3\frac{108.8}{100}\frac{94.6}{100}=100\frac{113.3}{100}\frac{108.8}{100}\frac{94.6}{100}$$

If you pay attention, wou will see that we have there the product of the *chain Index* in `r year(Sys.Date())-4`, `r year(Sys.Date())-3`, and `r year(Sys.Date())-2`. We divided by 100 because, to multiply, we need to divide by 100 before.

</small>

## Base Change

In case we have the data, we just need to compute the Index with the base that we want, however, if we do not have the data, and we just have a Fix Base index, we can do it all the same!

Say we have an index with base 0. Maybe we want to change it to base 2.

## Base Change

::: {#tbl-panel layout-ncol="2"}
| period | Index     | Formula           |
|--------|-----------|-------------------|
| 0      | $I_{0|0}$ | $\frac{x_0}{x_0}$ |
| 1      | $I_{1|0}$ | $\frac{x_1}{x_0}$ |
| 2      | $I_{2|0}$ | $\frac{x_2}{x_0}$ |
| 3      | $I_{3|0}$ | $\frac{x_3}{x_0}$ |
| ...    | ...       | ...               |
| t      | $I_{t|0}$ | $\frac{x_t}{x_0}$ |

: Base 0

| period | Index     | Formula           |
|--------|-----------|-------------------|
| 0      | $I_{0|2}$ | $\frac{x_0}{x_2}$ |
| 1      | $I_{1|2}$ | $\frac{x_1}{x_2}$ |
| 2      | $I_{2|2}$ | $\frac{x_2}{x_2}$ |
| 3      | $I_{3|2}$ | $\frac{x_3}{x_2}$ |
| ...    | ...       | ...               |
| t      | $I_{t|2}$ | $\frac{x_t}{x_2}$ |

: Base 2

Changing Base
:::

## Base Change

But how can we transform them, if we do not know $x_i$ $\forall i$?

. . .

$$I_{t|2}=\frac{x_t}{x_2}=1\frac{x_t}{x_2}=\frac{1/x_0}{1/x_0}\frac{x_t}{x_2}=\frac{\frac{x_t}{x_0}}{\frac{x_2}{x_0}}=\frac{I_{t|0}}{I_{2|0}}$$

And that is how we can re-base an index without knowing the value for the underlying variable ($x_t$)!

::: callout-tip
## Mixing up stuff

Previously we covered how to go from a chain index to a fixed base one. Now we saw how to change the base of a fixed base index. With both things together you can turn a chain index into fixed base one, with base you want!
:::

## Example

|   | `r year(Sys.Date())-5` | `r year(Sys.Date())-4` | `r year(Sys.Date())-3` | `r year(Sys.Date())-2` | `r year(Sys.Date())-1` | `r year(Sys.Date())` |
|-----------|:---------:|:---------:|:---------:|:---------:|:---------:|:---------:|
| Price | 30 | 34 | 37 | 35 | 36 | 39 |
| $I_{t|`r year(Sys.Date())-5`}$ | 100 | `r round(34/30*100,1)` | `r round(37/30*100,1)` | `r round(35/30*100,1)` | `r round(36/30*100,1)` | `r round(39/30*100,1)` |
|  | $\frac{100}{123.3}$ | $\frac{113.3}{123.3}$ | $\frac{123.3}{123.3}$ | $\frac{116.7}{123.3}$ | $\frac{120.0}{123.3}$ | $\frac{130.0}{123.3}$ |
| $I_{t|`r year(Sys.Date())-3`}$ | `r round(30/37*100,1)` | `r round(34/37*100,1)` | `r round(37/37*100,1)` | `r round(35/37*100,1)` | `r round(36/37*100,1)` | `r round(39/37*100,1)` |

: Stock prices

> New information? Yes! For example, without any computation we know that the price in `r year(Sys.Date())` was 30% larger than in `r year(Sys.Date())-5`, and 5.4% larger than in `r year(Sys.Date())-3`

## Tests for good Simple Index Numbers

We can test the properties for Simple Index Numbers. These represent desirable properties for good index numbers.

1.  **Identity test:** If the variable in the current period is the same as in the base period, the index should be 1 (or 100). Of course this implies $$I_{0|0}=1$$.
2.  **Proportionality test:** If the variable increases by $k$, the index should increase by $k$. $$x_t=kx_0\ \Rightarrow\ i_{t|0}=k$$

## Tests for good Simple Index Numbers {#factor-reversal}

3.  **Time Reversal test:** If you exchange the base between two periods, then the index in one base, should be the inverse of the other: $$i_{t|0}=\frac{1}{i{0|t}}\ \Leftrightarrow\ i_{t|0}i_{0|t}=1$$
4.  **Factor Reversal test:** If we have two index numbers, one for variable $x$ and another for $y$, then if $z=x\times y$ we should have $$i_{t|0}^z=i_{t|0}^x\times i_{t|0}^y$$

## Tests for good Simple Index Numbers

5.  **Circularity test:** The index at $t$ base $0$ should be the product of all the link index numbers up to $t$, $$i_{t|0}=i_{t|t-1}\times i_{t-1|t-2}...i_{2|1}\times i_{1|0}$$ This formalizes the relationship between fixed base and chain index numbers.

6.  **Homogeneity test:** If the variable, for every $t$ is multiplied by a constant, the index should not be affected.

## Tests for good Simple Index Numbers

7.  **Well-definedness:** The index number must be meaningful, and as prices and quantities usually are larger than zero, index numbers must be positive. Even further, a good index number should not take the value of $\infty$.

. . .

Ask yourself, what information are you getting here?

. . .

A value of $0$ might also be problematic, although it is not totally meaningless. The problem arises when you want to deal with chain index numbers, where a $0$ would indeterminate the rest of the chain. Also, you could never use as a base period, a period where the variable took the value of $0$.

# Index Numbers: Composite Index Numbers

## Composite Index Numbers

::: {.callout-note appearance="simple" icon="false"}
## Composite Index Numbers (a.k.a. Aggregate Index Numbers)

**Composite Index Numbers** are index numbers that have more than a single underlying variable, or which underlying variable is computed itself as a combination of other variables.

A composite index tracks the combined evolution of multiple phenomena at the same time. It summarizes how a diverse group of elements changes over time.

Example: The performance of a class, measured by the average grade. The average is computed with each individual grade, and therefore if we make an index based on the average of the class, we would have a composite index number.
:::

## Composite Index Numbers

This is a great opportunity to introduce another classification for our index numbers:

```{R}
grViz("
digraph flowchart {
  graph [layout = dot, rankdir = TB]
  node [shape = box, style = filled, fillcolor = lightgray, fontname = Helvetica]

  A [label = 'Index']
  B [label = <Price <i>P</i>>]
  C [label = <Quantity <i>Q</i>>]
  D [label = <Value <i>P</i> <i>&times;</i> <i>Q</i>>]

  A -> B
  A -> C
  A -> D
}
")
```

## Composite Index Numbers

Typically, values are collected in nominal terms, *i.e.* **current prices**, which is a *value*.

$$v_t=p_t\times q_t$$

. . .

Note that, if $\delta_{t+1}^v$ is the growth rate of $v_t$:

$$v_{t+1} = v_t\left(1+\delta_{t+1}^v\right)$$

and obviously, it is also true that:

$$v_{t+1} = p_{t+1}\times q_{t+1}$$

## Composite Index Numbers

But if we let $\delta_{t+1}^p$ be the growth rate of prices, and $\delta_{t+1}^p$ the growth rate of quantities we can rewrite $v_{t+1}$ as:

$$v_{t+1}=p_t\left(1+\delta_{t+1}^p\right)q_t\left(1+\delta_{t+1}^q\right)$$

. . .

$$v_{t+1} = p_tq_t(1+\delta_{t+1}^p)(1+\delta_{t+1}^q)$$

. . .

$$v_{t+1} = v_t(1+\delta_{t+1}^p)(1+\delta_{t+1}^q)$$

. . .

$$v_{t}(1+\delta_{t+1}^v) = v_t(1+\delta_{t+1}^p)(1+\delta_{t+1}^q)$$

##  {.big-emoji}

:bulb:

```{=html}
<style>
.big-emoji {
  font-size: 10em;
  text-align: center;
  vertical-align: middle;
}
</style>
```

## Composite Index Numbers

$$(1+\delta_{t+1}^v) = (1+\delta_{t+1}^p)(1+\delta_{t+1}^q)$$

$\delta_t^v$ is what we call **nominal change rate**, while $\delta_t^q$ is what we call **real change rate**. We can find out the real change rate ($\delta^q$), if we know the nominal change rate ($\delta^v$), and the prices change rate ($\delta^p$):

$$\left(1+\delta_{t}^q\right) = \frac{\left(1+\delta_t^v\right)}{\left(1+\delta_t^p\right)}$$ $$\delta_{t}^q = \frac{\left(1+\delta_t^v\right)}{\left(1+\delta_t^p\right)}-1$$

## Composite Index Numbers

Suppose we have index numbers for $v$, $q$, and $p$, all with base $b$ (remember you can re-base your index numbers easily if they do not share the same base).

$$I_{t|b}^q = \frac{I_{t|b}^v}{I_{t|b}^p}$$

. . .

$$\frac{q_t}{q_b} = \frac{\frac{v_t}{v_b}}{\frac{p_t}{p_b}}$$ $$\frac{q_t}{q_b} = \frac{\frac{p_tq_t}{p_bq_b}}{\frac{p_t}{p_b}}=\frac{p_tq_t}{p_bq_b}\frac{p_b}{p_t}=\frac{q_t}{q_b}$$

## Example

|   | `r year(Sys.Date()) - 4` | `r year(Sys.Date()) - 3` | `r year(Sys.Date()) - 2` | `r year(Sys.Date()) - 1` | `r year(Sys.Date())` |
|------------|------------|------------|------------|------------|------------|
| Sales Index | 99 | 100 | 107 | 110 | 111 |
| Price Index | 95 | 100 | 102 | 106 | 109 |

Let's find the quantities index, with base `r year(Sys.Date())-3`. Immediately we can fix $i_{t|b}^q=100$.

$$I_{`r year(Sys.Date()) - 4`}^q=\frac{I_{`r year(Sys.Date()) - 4`}^v}{I_{`r year(Sys.Date()) - 4`}^p}=\frac{99}{95}=`r round(99/95, 2)`$$

. . .

Then $I_{`r year(Sys.Date()) - 4`} = 104$, quantities decreased from `r year(Sys.Date()) - 4` to `r year(Sys.Date()) - 3`!

|   | `r year(Sys.Date()) - 4` | `r year(Sys.Date()) - 3` | `r year(Sys.Date()) - 2` | `r year(Sys.Date()) - 1` | `r year(Sys.Date())` |
|------------|------------|------------|------------|------------|------------|
| Quantities Index | `r 100*round(99/95, 4)` | `r 100*round(100/100, 4)` | `r 100*round(107/102, 4)` | `r 100*round(110/106, 4)` | `r 100*round(111/109, 4)` |

## Example

|   | `r year(Sys.Date()) - 4` | `r year(Sys.Date()) - 3` | `r year(Sys.Date()) - 2` | `r year(Sys.Date()) - 1` | `r year(Sys.Date())` |
|------------|------------|------------|------------|------------|------------|
| Quantities Index | `r 100*round(99/95, 4)` | `r 100*round(100/100, 4)` | `r 100*round(107/102, 4)` | `r 100*round(110/106, 4)` | `r 100*round(111/109, 4)` |

Now we can compute what was the real change rate between `r year(Sys.Date()) - 1` and `r year(Sys.Date())`:

. . .

$$\delta_{`r year(Sys.Date())`}=\frac{102}{104}-1=`r round((111/109)/(110/106),4)-1`=`r 100*(round((111/109)/(110/106),4)-1)`\%$$

> Real sales `r if ((111/109)/(110/106)-1 < 0) 'decreased' else 'increased'` `r abs(100*(round((111/109)/(110/106),4)-1))`% from `r year(Sys.Date())-1` to `r year(Sys.Date())`.

## Example

Let's check:

$$\delta_{2025}^q=\frac{(1+\delta_{2025}^v)}{(1+\delta_{2025}^p)}-1=\frac{111/110}{109/106}-1=`r round((111/110)/(109/106), 4)`-1$$ $$\delta_{2025}^q=`r round((111/110)/(109/106), 4)-1`=`r 100*round((111/110)/(109/106), 4)-100`\%$$

## Baskets

::: {.callout-note appearance="simple" icon="false"}
## Basket 🧺

**Basket** are sets of goods, which are used to track the evolution of, for example, a price level.

In economics, we often use price and quantity index numbers to measure how the prices or quantities of a set of goods (a **basket**) change over time.
:::

. . .

> A very important question: What are the weights that the different goods should have in the basket?

## Aggregate Index Numbers

From the family of formulas to create weighted composite index numbers, we will focus on the two most common:

1.  **Laspeyres**: uses base-period quantities (prices) as weights.

2.  **Paasche**: uses current-period quantities (prices) as weights.

. . .

These are used to measure the evolution of *prices (quantities)*.

## Kids' Explanation

::::::::: columns
::::: {.column width="50%"}
Old basket (🧺$_{past}$):

::: nonincremental
-   🍎 10 apples
-   🍊 5 oranges
:::

Old prices (🏷️$_{past}$):

::: nonincremental
-   $p_🍎=1$
-   $p_🍊=0.8$
:::
:::::

::::: {.column width="50%"}
New basket (🧺$_{today}$):

::: nonincremental
-   🍎 8 apples
-   🍊 6 oranges
:::

New prices (🏷️$_{today}$):

::: nonincremental
-   $p_🍎=1.2$
-   $p_🍊=1.1$
:::
:::::
:::::::::

Let's consider that the **base year is past**.

## Kids' Explanation - Prices

**Laspeyres - Price:**

Use always $🧺_{past}$, but relevant :label:! Laspeyres Price Index (LPI):

::: {style="text-align: center;"}
<small>

$$🧺_{past}|\text{🏷️}_{past}\quad LPI_{past}=\frac{10\times 1 + 5 \times 0.8}{10\times 1 + 5 \times 0.8} = \frac{14}{14}=1$$ $$🧺_{past}|\text{🏷️}_{today}\quad LPI_{today}=\frac{10\times 1.2 + 5\times 1.1}{10\times 1 + 5 \times 0.8}=\frac{17.5}{14}=`r round(17.5/14,2)`$$

</small>
:::

> Remember that 1 corresponds to 100, and `r round(17.5/14,2)` corresponds to `r round(17.5/14,2)*100`.

## Kids' Explanation - Prices

**Paasche - Price:**

Use always $🧺_{today}$! Paasche Price Index (PPI):

::: {style="text-align: center;"}
<small>

$$🧺_{today}|\text{🏷️}_{past}\quad PPI_{past}=\frac{8\times 1 + 6 \times 0.8}{8\times 1 + 6 \times 0.8} = \frac{12.8}{12.8}=1$$ $$🧺_{today}|\text{🏷️}_{today}\quad PPI_{today}=\frac{8\times 1.2 + 6\times 1.1}{8\times 1 + 6 \times 0.8}=\frac{16.2}{12.8}=`r round(16.2/12.8,2)`$$

</small>
:::

> Remember that 1 corresponds to 100, and `r round(16.2/12.8,2)` corresponds to `r round(16.2/12.8,2)*100`.

## In general - Laspeyres

1.  For prices, how much the old basket would cost at current prices relative to the **old basket and prices**? $$LPI = \frac{\sum_{k=1}^m p_t^k q_0^k}{\sum_{k=1}^m p_0^k q_0^k}$$

2.  For quantities, how much the current basket would cost at the old prices, relative to the **old basket and prices**? $$LQI = \frac{\sum_{k=1}^m p_0^k q_t^k}{\sum_{k=1}^m p_0^k q_0^k}$$

. . .

> Note: denominator is the same.

## In general - Paasche

1.  For prices, how much more expensive is the **current basket** at current prices, relative to the original prices. $$PPI = \frac{\sum_{k=1}^m p_t^kq_t^k}{\sum_{k=1}^m p_0^kq_t^k}$$

2.  For quantities, how much more the **current basket** costs, relative to what would cost the original basket at current prices. $$PQI = \frac{\sum_{k=1}^m p_t^kq_t^k}{\sum_{k=1}^m p_t^kq_0^k}$$

. . .

> Note: numerator is the same.

## Conclusions

1.  In both index numbers, for prices, quantities are constant: All variation comes from prices.

2.  In both index numbers, for quantities, prices are constant: All variation comes from quantities.

. . .

\

> We tend to use much more often *Laspeyres* because quantities take much longer to be accurately collected than prices. Ergo, national statistics institutes usually use Laspeyres price index to measure the price evolution.

## Fisher Index

Some authors argue, however, that the true measure for *cost of life* is in between both metrics. This is captured by the **Fisher Index**:

$$FPI_{t|0}=\sqrt{LPI_{t|0}\times PPI_{t|0}}$$

$$FQI_{t|0}=\sqrt{LQI_{t|0}\times PQI_{t|0}}$$

## Example

Suppose you collected the following data for years `r year(Sys.Date())-2`, `r year(Sys.Date())-1`, and `r year(Sys.Date())`, from a basket of 15 goods.

:::: {style="text-align: center;"}
<small>

| $P-Q$ | `r year(Sys.Date())-2` | `r year(Sys.Date())-1` | `r year(Sys.Date())` |
|-----------------|:-----------------:|:-----------------:|:-----------------:|
| `r year(Sys.Date())-2` | $\sum_{k=1}^{15} p_{`r year(Sys.Date())-2`}^k q_{`r year(Sys.Date())-2`}^k=8562$ | $\sum_{k=1}^{15} p_{`r year(Sys.Date())-2`}^k q_{`r year(Sys.Date())-1`}^k=9210$ | $\sum_{k=1}^{15} p_{`r year(Sys.Date())-2`}^k q_{`r year(Sys.Date())`}^k=9920$ |
| `r year(Sys.Date())-1` | $\sum_{k=1}^{15} p_{`r year(Sys.Date())-1`}^k q_{`r year(Sys.Date())-2`}^k=9150$ | $\sum_{k=1}^{15} p_{`r year(Sys.Date())-1`}^k q_{`r year(Sys.Date())-1`}^k=9584$ |  |
| `r year(Sys.Date())` | $\sum_{k=1}^{15} p_{`r year(Sys.Date())`}^k q_{`r year(Sys.Date())-2`}^k=9657$ |  | $\sum_{k=1}^{15} p_{`r year(Sys.Date())`}^k q_{`r year(Sys.Date())`}^k=10013$ |

\

What are the LPI, PPI, and FPI if we choose as a base year `r year(Sys.Date())-2`?

<table>
<thead>
<tr>
<th><p>$t$</p></th>
<th><p>`r year(Sys.Date())-2`</p></th>
<th><p>`r year(Sys.Date())-1`</p></th>
<th><p>`r year(Sys.Date())`</p></th>
</tr>
</thead>
<tbody>
<tr>
<td><p>$LPI_{t|`r year(Sys.Date())-2`}$</p></td>
<td><p>$100$</p></td>
<td><p>`r round(100*9150/8562,1)`</p></td>
<td><p>`r round(100*9657/8562,1)`</p></td>
</tr>
<tr>
<td><p>$PPI_{t|`r year(Sys.Date())-2`}$</p></td>
<td><p>$100$</p></td>
<td><p>`r round(100*9584/9210,1)`</p></td>
<td><p>`r round(100*10013/9920,1)`</p></td>
</tr>
<tr>
<td><p>$FPI_{t|`r year(Sys.Date())-2`}$</p></td>
<td><p>$100$</p></td>
<td><p>`r round(100*sqrt(9150/8562*9584/9210), 1)`</p></td>
<td><p>`r round(100*sqrt(9657/8562*10013/9920), 1)`</p></td>
</tr>
</tbody>
</table>

::: {.fragment data-fragment-index="5"}
$$LPI_{`r year(Sys.Date())-1`|`r year(Sys.Date())-2`}=100\times \frac{9150}{8562} \quad PPI_{`r year(Sys.Date())`|`r year(Sys.Date())-2`}=100\times\frac{10013}{9920}\quad FPI_{`r year(Sys.Date())-1`|`r year(Sys.Date())`}=\sqrt{106.9\times 104.1}$$
:::

</small>
::::

# Inflation

## Consumer Price Index

To measure inflation, we use a Laspeyres Price Index, usually known as CPI (Consumer Price Index).

. . .

To do that, the National Institute of Statistics (or the equivalent national statistical office) defines a basket, which contains a certain mix of goods and services, that is to be representative of the consumption behavior of the population.

. . .

In Portugal :portugal:, the index has base in 2016, and, as stated above, follows a LPI formulation with small technical adjustments. This index has a monthly frequency, *i.e.* it is computed every month.

## Consumer Price Index

To create a price index, you need to follow at least 3 steps.

1.  Determine representative basket: Survey families :family_woman_woman_girl_boy: :family_man_woman_boy_boy: :family_man_man_girl_boy:
2.  Survey retail stores to find out sale prices. :convenience_store:
3.  Compute the index with the collected data. :chart_with_upwards_trend:
    1.  Compute the cost of the :basket: with the prices at the base period.
    2.  Compute the cost of the same :basket: with the prices of every succesive period.

## Application

```{r}
library(eurostat)

# Get the HICP monthly index dataset
hicp_data <- get_eurostat("prc_hicp_midx", time_format = "date")

hicp_df <- hicp_data %>%
  filter(geo == "PT") %>% # Filter Portugal
  filter(unit == "I15") %>% # Filter Base year 2015
  filter(coicop == "CP00") # CP00	All-items, AP	All Products, APF	All but Food and Energy, FOOD ENERGY	SERV GOODS

hicp_df <- hicp_df %>% select(-geo, -unit, -coicop, -freq)

hicp_df <- hicp_df %>% rename(time = TIME_PERIOD, cpi = values)

hicp_df_a <- hicp_df %>% 
  mutate(year = year(time)) %>%
  group_by(year) %>%
  summarise(avg_cpi = mean(cpi, na.rm = TRUE))

hicp_df_a <- hicp_df_a %>% 
  filter(year >= year(Sys.Date())-4) %>%
  filter(year <= year(Sys.Date())-1)

hicp_df_a$avg_cpi <- round(hicp_df_a$avg_cpi, digits = 1)

```

A Labor union leader is complaining that the average salary in `r hicp_df_a[1,1]` was 1500, and in `r hicp_df_a[4,1]` it is 1650. This increase, they say, is not enough to maintain the workers' purshasing power, because of inflation. The data for inflation is the following:

| Year | `r hicp_df_a[1,1]` | `r hicp_df_a[2,1]` | `r hicp_df_a[3,1]` | `r hicp_df_a[4,1]` |
|---------------|:-------------:|:-------------:|:-------------:|:-------------:|
| CPI | `r hicp_df_a[1,2]` | `r hicp_df_a[2,2]` | `r hicp_df_a[3,2]` | `r hicp_df_a[4,2]` |

1.  The year with the largest increase in prices was `r hicp_df_a[3,1]`?
2.  The average growth rate for the wages between `r hicp_df_a[1,1]` and `r hicp_df_a[4,1]` was \_\_\_\_\_\_\_?
3.  Is the union leader right?

## Application

For the first question, we can compute the chain or link index:

<table>
<thead>
<tr>
<th><p>Year</p></th>
<th><p>`r hicp_df_a[1,1]`</p></th>
<th><p>`r hicp_df_a[2,1]`</p></th>
<th><p>`r hicp_df_a[3,1]`</p></th>
<th><p>`r hicp_df_a[4,1]`</p></th>
</tr>
</thead>
<tbody>
<tr>
<td><p>CPI</p></td>
<td><p>`r hicp_df_a[1,2]`</p></td>
<td><p>`r hicp_df_a[2,2]`</p></td>
<td><p>`r hicp_df_a[3,2]`</p></td>
<td><p>`r hicp_df_a[4,2]`</p></td>
</tr>
<tr>
<td><p>CPI<sub>link</sub></p></td>
<td><p>---</p></td>
<td><p>`r round(hicp_df_a[2,2]/hicp_df_a[1,2]*100,1)`</p></td>
<td><p>`r round(hicp_df_a[3,2]/hicp_df_a[2,2]*100,1)`</p></td>
<td><p>`r round(hicp_df_a[4,2]/hicp_df_a[3,2]*100,1)`</p></td>
</tr>
</tbody>
</table>

. . .

So the answer is: The year with the largest price increase was `r if (round(hicp_df_a[2,2]/hicp_df_a[1,2]*100,1) == max(round(hicp_df_a[2,2]/hicp_df_a[1,2]*100,1),round(hicp_df_a[3,2]/hicp_df_a[2,2]*100,1),round(hicp_df_a[4,2]/hicp_df_a[3,2]*100,1))) hicp_df_a[2,1] else if (round(hicp_df_a[3,2]/hicp_df_a[2,2]*100,1) == max(round(hicp_df_a[2,2]/hicp_df_a[1,2]*100,1),round(hicp_df_a[3,2]/hicp_df_a[2,2]*100,1),round(hicp_df_a[4,2]/hicp_df_a[3,2]*100,1))) hicp_df_a[3,1] else hicp_df_a[4,1]`.

> Just in case there were doubts, an example: $$CPI_{link|`r hicp_df_a[3,1]`}=\frac{`r hicp_df_a[3,2]`}{`r hicp_df_a[2,2]`}\times 100=`r round(hicp_df_a[3,2]/hicp_df_a[2,2]*100,1)`$$

## Application

We know salary in `r hicp_df_a[1,1]` was 1500, and in `r hicp_df_a[4,1]` 1650. If the growth rate was constant, say $\delta_w$ we would have:

. . .

$$1650 = 1500(1+\delta_w)^{`r hicp_df_a[4,1]- hicp_df_a[1,1]`}$$

Or conversely

$$\frac{1650}{1500}=(1+\delta_w)^{`r hicp_df_a[4,1]-hicp_df_a[1,1]`}$$

. . .

or

. . .

$$\left(`r round(1650/1600,4)`\right)^{1/`r hicp_df_a[4,1]- hicp_df_a[1,1]`}=1+\delta_w$$

. . .

$$`r round((1650/1600)^(1/(hicp_df_a[4,1]-hicp_df_a[1,1])),4)`-1=\delta_w \quad \Rightarrow \quad \delta_w=`r round((1650/1600)^(1/(hicp_df_a[4,1]-hicp_df_a[1,1]))-1,4)`= `r round(100*(1650/1600)^(1/(hicp_df_a[4,1]-hicp_df_a[1,1]))-100,2)`\%$$

## Summarizing

Remember this relationship we saw before? $$I^q_{t|b}=\frac{I^v_{t|b}}{I^p_{t|b}}$$

**Real** equals **nominal** over **CPI**.

This, dividing by CPI a nominal quantity, is known as *to deflate* by the CPI.

## About the Test for Factor Reversal for Composite Index Numbers

Note that neither Laspeyres nor Paasche pass the test for **factor reversal** (<a href="#factor-reversal">see here</a>), $$VI_{t|0}\neq LPI_{t|0}\times LQI_{t|0}\quad\quad VI_{t|0}\neq PPI_{t|0}\times PQI_{t|0}$$

But we can verify that: $$LPI_{t|0}\times PQI_{t|0}=IV_{t|0} \quad \quad PPI_{t|0}\times LQI_{t|0}=IV_{t|0}$$

## About the Test for Factor Reversal for Composite Index Numbers

(... continuation)

Example (do the rest as homework): $$LPI_{t|0}\times PQI_{t|0}=\frac{\sum_{k=1}^m p_t^kq_0^k}{\sum_{k=1}^m p_0^kq_0^k}\frac{\sum_{k=1}^m p_t^kq_t^k}{\sum_{k=1}^m p_t^kq_0^k}=\frac{\sum_{k=1}^m p_t^kq_t^k}{\sum_{k=1}^m p_0^kq_0^k}$$

Note that this last item is exactly $IV_{t|0}$.

. . .

You can verify, using the same procedure, that Fisher's index does indeed passess the factor reversal test.

## About the Factor Reversal Test for Composite Index Numbers

$$FPI_{t|0}\times FQI_{t|0}=$$ $$\sqrt{LPI_{t|0}\times PPI_{t|0}}\times\sqrt{LQI_{t|0}\times PQI_{t|0}}$$ $$\sqrt{LPI_{t|0}\times PPI_{t|0}\times LQI_{t|0}\times PQI_{t|0}}$$ $$\sqrt{LPI_{t|0}\times PQI_{t|0}\times LQI_{t|0}\times PPI_{t|0}}$$ $$\sqrt{IV_{t|0}\times IV_{t|0}}=\sqrt{IV_{t|0}^2}=IV_{t|0}$$

## About the Time Reversal Test for Composite Index Numbers

Laspeyres and Paasche do not pass the time Reversal test, let's see an example:

$$LPI_{t|0}\times LPI_{0|t} = \frac{\sum_{k=1}^m p_t^k q_0^k}{\sum_{k=1}^m p_0^k q_0^k}\frac{\sum_{k=1}^m p_0^k q_t^k}{\sum_{k=1}^m p_t^k q_t^k}\neq 1$$

You can do the same for Paasche, and for the quantities index numbers.

## About the Time Reversal Test for Composite Index Numbers {.slide data-transition="none"}

Fisher on the other hand...

$$FPI_{t|0}\times FPI_{0|t}=\sqrt{LPI_{t|0}PPI_{t|0}}\sqrt{LPI_{0|t}PPI_{0|t}}$$

. . .

$$=\sqrt{\frac{\sum_{k=1}^m p_t^k q_0^k}{\sum_{k=1}^m p_0^k q_0^k}\frac{\sum_{k=1}^m p_t^k q_t^k}{\sum_{k=1}^m p_0^k q_t^k}}\sqrt{\frac{\sum_{k=1}^m p_0^k q_t^k}{\sum_{k=1}^m p_t^k q_t^k}\frac{\sum_{k=1}^m p_0^k q_0^k}{\sum_{k=1}^m p_t^k q_0^k}}$$

. . .

$$=\sqrt{\frac{\sum_{k=1}^m p_t^k q_0^k}{\sum_{k=1}^m p_0^k q_0^k}\frac{\sum_{k=1}^m p_t^k q_t^k}{\sum_{k=1}^m p_0^k q_t^k}\frac{\sum_{k=1}^m p_0^k q_t^k}{\sum_{k=1}^m p_t^k q_t^k}\frac{\sum_{k=1}^m p_0^k q_0^k}{\sum_{k=1}^m p_t^k q_0^k}}$$

## About the Time Reversal Test for Composite Index Numbers {.slide data-transition="none"}

Fisher on the other hand...

$$FPI_{t|0}\times FPI_{0|t}=\sqrt{LPI_{t|0}PPI_{t|0}}\sqrt{LPI_{0|t}PPI_{0|t}}$$

$$=\sqrt{\frac{\sum_{k=1}^m p_t^k q_0^k}{\sum_{k=1}^m p_0^k q_0^k}\frac{\sum_{k=1}^m p_t^k q_t^k}{\sum_{k=1}^m p_0^k q_t^k}}\sqrt{\frac{\sum_{k=1}^m p_0^k q_t^k}{\sum_{k=1}^m p_t^k q_t^k}\frac{\sum_{k=1}^m p_0^k q_0^k}{\sum_{k=1}^m p_t^k q_0^k}}$$

$$=\sqrt{\frac{\color{red}{\sum_{k=1}^m p_t^k q_0^k}}{\color{blue}{\sum_{k=1}^m p_0^k q_0^k}}\frac{\color{green}{\sum_{k=1}^m p_t^k q_t^k}}{\sum_{k=1}^m p_0^k q_t^k}\frac{\sum_{k=1}^m p_0^k q_t^k}{\color{green}{\sum_{k=1}^m p_t^k q_t^k}}\frac{\color{blue}{\sum_{k=1}^m p_0^k q_0^k}}{\color{red}{\sum_{k=1}^m p_t^k q_0^k}}}$$

. . .

$$FPI_{t|0}\times FPI_{0|t}=1$$

## About the Circularity Test for Composite Index Numbers

None, not even Fisher's Index pass the circularity test.

> Homework: Verify it.

## Example

<table>
<thead>
<tr>
<th><p></p></th>
<th><p>Year 1</p></th>
<th><p>Year 2</p></th>
</tr>
</thead>
<tbody>
<tr>
<td><p>Public Transportation</p></td>
<td><p>N Trips</p></td>
<td><p>Ticket price</p></td>
</tr>
<tr>
<td><p>Bus</p></td>
<td><p>1,763,521</p></td>
<td><p>1.15</p></td>
</tr>
<tr>
<td><p>Metro</p></td>
<td><p>3,148,350</p></td>
<td><p>1.2</p></td>
</tr>
</tbody>
</table>

## Example

1.  According to LPI for year 2, prices for public transportantion grew 11.17%.
2.  Real change, according to Paasche, for public transportation was 7.35%.
3.  The composite index for change in expenditures with public transportation in year 2 compared the expenditure in year 1 is what type of change? (real, nominal, quantity, prices?) How much was it?

## Example

**According to LPI for year 2, prices for public transportantion grew 11.17%.**

. . .

First, we need to find $p_2$ for bus and metro.

. . .

$$108.7=\frac{p_2^{bus}}{1.15}\times 100$$

. . .

Or $p_2^{bus}=`r round(108.7/100*1.15,2)`$

$$112.5=\frac{p_2^{metro}}{1.2}$$

Or $p_2^{metro}=`r round(112.5/100*1.2,2)`$

## Example

<table>
<thead>
<tr>
<th><p></p></th>
<th><p>Year 1</p></th>
<th><p>Year 2</p></th>
</tr>
</thead>
<tbody>
<tr>
<td><p>Public Transportation</p></td>
<td><p>N Trips</p></td>
<td><p>Ticket price</p></td>
</tr>
<tr>
<td><p>Bus</p></td>
<td><p>1,763,521</p></td>
<td><p>1.15</p></td>
</tr>
<tr>
<td><p>Metro</p></td>
<td><p>3,148,350</p></td>
<td><p>1.2</p></td>
</tr>
</tbody>
</table>

## Example

$$LPI_{2|1}=\frac{\sum_{k=1}^m p_2^k q_1^k}{\sum_{k=1}^m p_1^k q_1^k}$$

. . .

$$LPI_{2|1}=\frac{1,763,521\times 1.25 + 3,148,350 \times 1.35}{1,763,521\times 1.15 + 3,148,350 \times 1.2}$$

. . .

$$LPI_{2|1}=`r round((1763521 * 1.25 + 3148350 * 1.35)/(1763521*1.15 + 3148350*1.2), 4)`$$

. . .

> The *basket* in year 2 is 11.17% more expensive than in year 1. $$LPI_{2|1}\times 100 - 100 = 11.17\%$$

## Example

**Real change, according to Paasche, for public transportation was 7.35%.**

$$PQI_{2|1}=\frac{\sum_{k=1}^m p_2^k q_2^k}{\sum_{k=1}^m p_2^k q_1^k}$$

$$PQI_{2|1}=\frac{1,875,345\times 1.25 + 3,396,138\times 1.35}{1,763,521\times 1.25 + 3,148,350\times 1.35}$$

$$PQI_{2|1}=`r round((1875345*1.25 + 3396138* 1.35)/(1763521 * 1.25 + 3148350* 1.35), 4)`$$

> Indeed, according to the Paasche index, in year 2 the amount of public transportantion trips was 7.35% larger than in year 1. $$PQI_{2|1}\times 100 - 100 = 7.35\%$$

## Example

**The composite index for change in expenditures with public transportation in year 2 compared the expenditure in year 1 is what type of change? (real, nominal, quantity, prices?) How much was it?**

The value index for public transportation is a *nominal* index (price times quantity).

. . .

> **Remember:** $$VI_{t|0}=LPI_{t|0}\times PQI_{t|0}$$

## Example

$$VI_{2|1}=LPI_{2|1}\times PQI_{2|1} = 1.1117 \times 1.0735 \approx `r round(1.1117*1.0735, 4)`$$

The value of publc transportation trips grew 19.34% from year 1 to year 2. This includes the effect of an increase in prices and quantities.